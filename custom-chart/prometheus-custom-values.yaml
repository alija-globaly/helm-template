# Global Configuration
nameOverride: ""
fullnameOverride: ""

# ============================================================================
# Prometheus Server Configuration
# ============================================================================
prometheus:
  enabled: true
  
  prometheusSpec:
    retention: 20d 
    retentionSize: "14GB"
    
    resources:
      requests:
        cpu: 300m
        memory: 1Gi
      limits:
        cpu: 800m
        memory: 2Gi
    
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: "my-rawfile"
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 15Gi
    
    scrapeInterval: 30s  
    scrapeTimeout: 10s
    evaluationInterval: 30s
    
    externalLabels:
      cluster: staging
      environment: staging
      region: ap-southeast-2

    enableAdminAPI: false

    # Service Monitor Selector
    serviceMonitorSelector:
      matchLabels:
        prometheus: kube-prometheus
    
    podMonitorSelector:
      matchLabels:
        prometheus: kube-prometheus
    
    ruleSelector:
      matchLabels:
        prometheus: kube-prometheus
    
    # High Availability - Multiple replicas
    replicas: 1
    affinity: {}
    # affinity:
    #   podAntiAffinity:
    #     preferredDuringSchedulingIgnoredDuringExecution:
    #       - weight: 100
    #         podAffinityTerm:
    #           labelSelector:
    #             matchExpressions:
    #               - key: app.kubernetes.io/name
    #                 operator: In
    #                 values:
    #                   - prometheus
    #           topologyKey: kubernetes.io/hostname

    
    # Remote Write - Send to long-term storage (optional)
    remoteWrite: []

    # Additional Scrape Configs
    additionalScrapeConfigs: []

    # Pod Security
    securityContext:
      runAsGroup: 2000
      runAsNonRoot: true
      runAsUser: 1000
      fsGroup: 2000
      seccompProfile:
        type: RuntimeDefault
    
    # Priority Class (ensure Prometheus pods are scheduled first)
    priorityClassName: ""
    
  # Service Configuration
  # service:
  #   type: ClusterIP
  #   port: 9090
  #   targetPort: 9090

  service:
    type: NodePort
    ports:
      - port: 9090
        nodePort: 30090  
    targetPort: 9090  

  ingress:
    enabled: false

# ============================================================================
# Alertmanager Configuration (High Availability)
# ============================================================================
alertmanager:
  enabled: false
  
  alertmanagerSpec:
    replicas: 1
    
    # Resource Limits
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
  
    # Storage
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: ""
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 5Gi
    
    # External URL
    externalUrl: https://alertmanager.yourdomain.com

    # affinity:
    #   nodeAffinity:
    #     requiredDuringSchedulingIgnoredDuringExecution:
    #       nodeSelectorTerms:
    #       - matchExpressions:
    #         - key: kubernetes.io/e2e-az-name
    #           operator: In
    #           values:
    #           - e2e-az1
    #           - e2e-az2

  # Alertmanager Configuration
  config:
    global:
      resolve_timeout: 5m

    # Templates
    templates:
      - '/etc/alertmanager/config/*.tmpl'
      
    # Route Configuration
    route:
      group_by: ['namespace']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 12h
      receiver: 'null'
      routes:
      - receiver: 'null'
        matchers:
          - alertname = "Watchdog"
  
    # Receivers
    receivers:
    - name: 'null'
  
  # Ingress
  ingress:
    enabled: false

# ============================================================================
# Grafana
# ============================================================================
grafana:
  enabled: false

# ============================================================================
# Node Exporter
# ============================================================================
nodeExporter:
  enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 50Mi
    limits:
      cpu: 100m
      memory: 100Mi

# ============================================================================
# Kube State Metrics
# ============================================================================

kubeStateMetrics:
  enabled: true

kube-state-metrics:
  releaseLabel: true
  prometheus:
    monitor:
      enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 50Mi
    limits:
      cpu: 100m
      memory: 100Mi

# ============================================================================
# Prometheus Operator
# ============================================================================
prometheusOperator:
  enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 50Mi
    limits:
      cpu: 100m
      memory: 100Mi


# ============================================================================
# Default Alerting Rules
# ============================================================================
defaultRules:
  create: true
  labels:
    environment: staging
    cluster: staging

# ============================================================================
# Component Scraping
# ============================================================================
kubeApiServer:
  enabled: true

kubelet:
  enabled: true

kubeControllerManager:
  enabled: false

coreDns:
  enabled: true

kubeEtcd:
  enabled: false

kubeScheduler:
  enabled: false

kubeProxy:
  enabled: false

# ============================================================================
# Global settings
# ============================================================================
global:
  rbac:
    create: true